# Управление узлами кластера

## Добавление узла

После подготовки узла для добавления к существующему кластеру `Proxmox VE` на новом узле необходимо выполнить команду:

```bash
pvecm add any_cluster_node_name \
  -link0 address=10.0.0.42 -link1 address=10.1.0.42 -link2 address=10.2.0.42
```

После добавления узла в кластер его публичные ключи `SSH` будут добавлены в файл `/etc/ssh/ssh_known_hosts`, который является ссылкой на общий для кластера файл `/etc/pve/priv/known_hosts`, но только с именем нового узла и IP адресом `link0`. 

{% hint style="info" %}
Если для репликации и миграции контейнеров и виртуальных машин используется отдельная сеть, то удобно в файле `/etc/pve/priv/known_hosts`продублировать ключи с указанием необходимых доменных имен и IP адресов, чтобы избежать добавления ключей нового узла на других в файл `/root/.ssh/known_hosts`
{% endhint %}

## Удаление узла

Для удаления узла из кластера `Proxmox VE` необходимо перенести нагрузку на другие узлы и выключить узел, который планируется к удалению.

{% hint style="info" %}
Важно, чтобы удаляемый узел был выключен или отключен от сети, чтобы его экземпляр сервиса `corosync` не взаимодействовал с сервисами `corosync` на других узлах
{% endhint %}

Далее на любом из оставшихся узлов выполняется команда:

```bash
pvecm delnode node_name
```

После удаления узла в общем для кластера файле `/etc/pve/priv/known_hosts`, остаются ключи удаленного узла. Их желательно удалить из этого файла, особенно, если планируется в дальнейшем повторное добавление узла с таким же именем, как у удаленного.

## Ссылки

[https://pve.proxmox.com/wiki/Cluster\_Manager](https://pve.proxmox.com/wiki/Cluster_Manager)

